<?xml version="1.0" standalone="yes"?>

<!-- Generated by BEAUTi v1.10.5 Prerelease #23570d1                         -->
<!--       by Alexei J. Drummond, Andrew Rambaut and Marc A. Suchard         -->
<!--       Department of Computer Science, University of Auckland and        -->
<!--       Institute of Evolutionary Biology, University of Edinburgh        -->
<!--       David Geffen School of Medicine, University of California, Los Angeles-->
<!--       http://beast.community/                                           -->
<beast version="1.10.5">
	

	<!-- The list of taxa to be analysed (can also include dates/ages).          -->
	<!-- ntax=104                                                                -->
	<taxa id="taxa">
	</taxa>
	

	<newick id="startingTree" usingDates="true" usingHeights="false" units="days">
	</newick>

	<!-- Generate a tree model                                                   -->
	<treeModel id="treeModel">
		<upgmaTree idref="startingTree"/>
		<rootHeight>
			<parameter id="treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="treeModel.allInternalNodeHeights"/>
		</nodeHeights>
		<nodeTraits name="location" rootNode="false" internalNodes="false" leafNodes="true" traitDimension="2">
            <parameter id="location.leafTraits"/>
        </nodeTraits>

	</treeModel>

	<!-- Statistic for sum of the branch lengths of the tree (tree length)       -->
	<treeLengthStatistic id="treeLength">
		<treeModel idref="treeModel"/>
	</treeLengthStatistic>

	<!-- Statistic for time of most recent common ancestor of tree               -->
	<tmrcaStatistic id="age(root)" absolute="true">
		<treeModel idref="treeModel"/>
	</tmrcaStatistic>


	<multivariateDiffusionModel id="location.diffusionModel">
		<precisionMatrix>
            <cachedMatrixInverse id="location.precision.matrix">
                <compoundSymmetricMatrix id="location.variance.matrix" asCorrelation="true" isCholesky="true">
                    <diagonal>
                        <parameter id="location.variance.diagonal" value="10 10" lower="0 0"/>
                    </diagonal>
                    <offDiagonal>
                        <parameter id="location.variance.offDiagonal" value="0.0"/>
                    </offDiagonal>
                </compoundSymmetricMatrix>
            </cachedMatrixInverse>
        </precisionMatrix>
	</multivariateDiffusionModel>
	
	<halfTPrior id="location.variance.prior" df="1" scale="2.5">
        <parameter idref="location.variance.diagonal"/>
    </halfTPrior>


	<traitDataLikelihood id="location.traitLikelihood" traitName="location" useTreeLength="true" scaleByTime="false" reportAsMultivariate="true" reciprocalRates="false" integrateInternalTraits="true" forceFullPrecision="true" integratedProcess="true">
		<multivariateDiffusionModel idref="location.diffusionModel"/>
		<treeModel idref="treeModel"/>
		<traitParameter>
            <parameter idref="location.leafTraits"/>
        </traitParameter>
		<conjugateRootPrior>
			<meanParameter>
				<parameter value="0.0 0.0 0.0 0.0"/>
			</meanParameter>
			<priorSampleSize>
				<parameter value="0.0000001"/>
			</priorSampleSize>
		</conjugateRootPrior>
	</traitDataLikelihood>

    <traitDataContinuousDiffusionStatistic id="location.velocityStatistic" traitName="location" displacementScheme="greatCircleDistance" scalingScheme="dependent" weightingScheme="unweighted" estimationScheme="nodeStatistic">
        <traitDataLikelihood idref="location.traitLikelihood"/>
    </traitDataContinuousDiffusionStatistic>
    
	<!-- END Multivariate diffusion model                                        -->


	<!-- Define operators                                                        -->
	<operators id="operators" optimizationSchedule="log">

       <randomWalkOperator windowSize="0.1" weight="0.5" boundaryCondition="log">
           <parameter idref="location.variance.diagonal"/>
       </randomWalkOperator>

	</operators>
	

	<!-- Define MCMC                                                             -->
	<mcmc id="mcmc" chainLength="50000" autoOptimize="true">
		<joint id="joint">
			<prior id="prior">
				<halfTPrior idref="location.variance.prior"/>

			</prior>
			<likelihood id="likelihood">
				<multivariateTraitLikelihood idref="location.traitLikelihood"/>
			</likelihood>
		</joint>
		<operators idref="operators"/>

		<!-- write log to screen                                                     -->
		<log id="screenLog" logEvery="1000">
			<column label="Joint" dp="4" width="12">
				<joint idref="joint"/>
			</column>
			<column label="Prior" dp="4" width="12">
				<prior idref="prior"/>
			</column>
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood"/>
			</column>
			<column label="age(root)" sf="6" width="12">
				<tmrcaStatistic idref="age(root)"/>
			</column>
			<column label="velocity" sf="6" width="12">
				<tmrcaStatistic idref="location.velocityStatistic"/>
			</column>
		</log>

		<!-- write log to file                                                       -->
		<log id="fileLog" logEvery="100" fileName="sim_ibm_beast_fixedtree.log" overwrite="false">
			<joint idref="joint"/>
			<prior idref="prior"/>
			<likelihood idref="likelihood"/>
			<multivariateTraitLikelihood idref="location.traitLikelihood"/>
			<parameter idref="treeModel.rootHeight"/>
			<tmrcaStatistic idref="age(root)"/>
			<treeLengthStatistic idref="treeLength"/>

           <parameter idref="location.variance.diagonal"/>
           <parameter idref="location.variance.offDiagonal"/>
           <parameter idref="location.velocityStatistic"/>


            <traitLogger traitName="location" nodes="all" taxonNameExplicit="true">
                <multivariateTraitLikelihood idref="location.traitLikelihood"/>
                <treeModel idref="treeModel"/>
            </traitLogger> 
			
		</log>

		<!-- write tree log to file                                                  -->
		<logTree id="treeFileLog" logEvery="100" nexusFormat="true" fileName="sim_ibm_beast_fixedtree.trees" sortTranslationTable="true">
			<treeModel idref="treeModel"/>
			<joint idref="joint"/>
			
			<trait name="position.location" tag="location">
				<traitDataLikelihood idref="location.traitLikelihood"/>
			</trait>
			
			<trait name="velocity.location" tag="velocity">
				<traitDataLikelihood idref="location.traitLikelihood"/>
			</trait>

		</logTree>


	</mcmc>
	
	<report>
		<property name="timer">
			<mcmc idref="mcmc"/>
		</property>
	</report>
	
</beast>
